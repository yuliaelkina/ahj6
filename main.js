(()=>{"use strict";class e{constructor(e){"string"==typeof e&&(e=document.querySelector(e)),this._element=e,this.buttons=[...document.querySelectorAll(".task-widget__button")],this.columns=[...this._element.querySelectorAll(".task-widget__column")],this.crossCode="&#10008;"}init(){if(localStorage.getItem("taskWidgetMemory")){const e=JSON.parse(localStorage.getItem("taskWidgetMemory"));for(let t=0;t<this.columns.length;t++)e[`column${t}`].forEach((e=>{this.newTask(e,this.columns[t])}))}this.buttons.forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),this.addNewCard(e)}))})),window.addEventListener("unload",(()=>{localStorage.setItem("taskWidgetMemory",`${this.saveTasks()}`)}))}addNewCard(e){const t=document.createElement("div");t.classList.add("add-card__form"),t.innerHTML='<textarea class="add-card__input" rows="2"></textarea>\n    <button type="button" class="add-card__button">Add card</button>\n    <button type="button" class="add-card__close">&#215;</button>';const s=e.closest(".task-widget__column");s.appendChild(t);const o=t.querySelector(".add-card__input");t.querySelector(".add-card__close").addEventListener("click",(()=>{t.closest(".task-widget__column").removeChild(t)})),t.querySelector(".add-card__button").addEventListener("click",(()=>{this.newTask(o.value,s),t.closest(".task-widget__column").removeChild(t)}))}newTask(e,t){const s=document.createElement("div");s.classList.add("task-widget__item"),s.innerText=`${e}`,t.appendChild(s),this.addhoverListeners(s),this.addDnDListeners(s)}addhoverListeners(e){e.addEventListener("mouseenter",(()=>{document.body.style.cursor="pointer",this.addDeleteButton(e)})),e.addEventListener("mouseleave",(()=>{e.removeChild(e.querySelector(".task-widget__item--close")),document.body.style.cursor="default"}))}addDnDListeners(e){let t,s,o,n,d;e.addEventListener("mousedown",(e=>{e.preventDefault(),"task-widget__item--close"!==e.target.className&&(t=e.target,s=t.offsetWidth,o=t.offsetHeight,t.closest(".task-widget__column").removeChild(t),document.body.style.cursor="grabbing",t.classList.add("task-widget__item--dragged"),t.style.width=`${s}px`,t.style.height=`${o}px`,document.body.appendChild(t),t.style.left=e.pageX-t.offsetWidth/2+"px",t.style.top=e.pageY-t.offsetHeight/2+"px")})),e.addEventListener("mousemove",(e=>{e.preventDefault(),t&&(this._element.querySelectorAll(".task-widget__item").forEach((e=>{e.style.marginBottom="2px",e.style.marginTop="2px"})),t.style.left=e.pageX-t.offsetWidth/2+"px",t.style.top=e.pageY-t.offsetHeight/2+"px",n=document.elementsFromPoint(e.clientX,e.clientY).find((e=>"task-widget__item"===e.className)),n&&(d=n.getBoundingClientRect(),e.pageY>window.scrollY+d+n.offsetHeight/2?n.style.marginBottom=`${o+2}px`:n.style.marginTop=`${o+2}px`))})),e.addEventListener("mouseup",(e=>{if(e.preventDefault(),t){if(t.classList.remove("task-widget__item--dragged"),t.style.width="98%",t.style.height="auto",t.style.top="auto",t.style.left="auto",document.body.removeChild(t),document.body.style.cursor="pointer",n)e.pageY>window.scrollY+d+n.offsetHeight/2?n.parentNode.insertBefore(t,n.nextElementSibling):n.parentNode.insertBefore(t,n);else{document.elementsFromPoint(e.clientX,e.clientY).find((e=>"task-widget__column"===e.className)).appendChild(t)}this._element.querySelectorAll(".task-widget__item").forEach((e=>{e.style.marginBottom="2px",e.style.marginTop="2px"})),t=null,n=null,d=null}}))}addDeleteButton(e){const t=document.createElement("div");t.innerHTML=this.crossCode,t.classList.add("task-widget__item--close"),e.appendChild(t),t.addEventListener("click",(()=>{e.closest(".task-widget__column").removeChild(e)}))}saveTasks(){const e={};for(let t=0;t<this.columns.length;t++){const s=[];this.columns[t].querySelectorAll(".task-widget__item").forEach((e=>{const t=e.innerText;s.push(t)})),e[`column${t}`]=s}return JSON.stringify(e)}}document.addEventListener("DOMContentLoaded",(()=>{new e(document.querySelector(".task-widget")).init()}))})();